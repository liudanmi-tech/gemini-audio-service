# 诊断图片生成问题

## 1. 检查返回的 JSON 内容

```bash
# 查看完整的响应
cat response.json | python3 -m json.tool

# 或者查看响应大小和内容
echo "响应大小: $(wc -c < response.json) 字节"
head -20 response.json
```

## 2. 查看详细的错误日志

```bash
# 查看最近的完整日志
tail -200 ~/gemini-audio-service.log | tail -50

# 查看所有错误
tail -200 ~/gemini-audio-service.log | grep -E "错误|Error|失败|Failed|Exception" | tail -20

# 查看图片生成相关的所有日志
tail -300 ~/gemini-audio-service.log | grep -A 10 -B 5 "图片生成\|generate_image"
```

## 3. 检查策略分析接口是否被调用

```bash
# 查看策略分析接口的调用日志
tail -300 ~/gemini-audio-service.log | grep -A 20 "策略分析\|generate_strategies" | tail -40
```

## 4. 直接运行 Python 测试图片生成

```bash
python3 -c "
import sys
sys.path.insert(0, '/home/admin/gemini-audio-service')
from main import generate_image_from_prompt

# 测试图片生成
result = generate_image_from_prompt('米色背景，极简火柴人线稿。左侧为用户，右侧为对方。', 'test-session', 0)
print(f'结果类型: {type(result)}')
print(f'结果长度: {len(result) if result else 0}')
if result:
    if result.startswith('http'):
        print(f'✅ 返回 URL: {result[:80]}...')
    else:
        print(f'✅ 返回 Base64 (长度: {len(result)} 字符)')
else:
    print('❌ 返回 None')
"
```
