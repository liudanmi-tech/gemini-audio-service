# 阿里云轻量应用服务器 - 防火墙配置详细步骤

## 🎯 目标
开放 **8001 端口**，允许外部访问 FastAPI 服务

## 📋 详细步骤

### 方法 1: 通过顶部导航栏（推荐）

1. **点击"防火墙"标签**
   - 在服务器概览页面顶部，找到导航栏
   - 点击 **"防火墙"** 标签（在"域名"和"安全防护"之间）

2. **查看现有规则**
   - 进入防火墙页面后，会看到现有的防火墙规则列表
   - 当前显示"已设置4条"规则

3. **添加新规则**
   - 点击页面上的 **"添加规则"** 或 **"添加防火墙规则"** 按钮
   - 会弹出添加规则的对话框

4. **填写规则信息**
   ```
   规则方向: 入站规则（Inbound）
   协议: TCP
   端口范围: 8001
   授权对象: 0.0.0.0/0  （允许所有IP访问）
   备注: FastAPI 音频分析服务
   ```

5. **保存规则**
   - 点击 **"确定"** 或 **"保存"** 按钮
   - 规则会立即生效

### 方法 2: 通过应用搭建指南（如果方法1找不到）

1. **点击"应用搭建指南"**
   - 在服务器概览页面，找到"应用搭建指南"部分
   - 点击 **"Step2. 站点设置"** 下的 **"防火墙"** 链接（显示"已设置4条"）

2. **后续步骤同方法1的步骤3-5**

## 📝 规则配置说明

### 端口范围
- **单个端口**: `8001`
- **端口范围**: `8001/8001`（如果系统要求范围格式）

### 授权对象（IP地址）
- **允许所有IP**: `0.0.0.0/0`（开发测试用）
- **仅允许特定IP**: 输入你的IP地址（更安全，但需要知道你的公网IP）

### 协议类型
- 选择 **TCP**（HTTP/HTTPS 使用 TCP 协议）

## ✅ 验证配置

配置完成后，在你的 Mac 上测试：

```bash
# 测试连接
curl http://47.79.254.213:8001/health

# 应该返回：
# {"message":"音频分析服务正在运行","status":"ok"}
```

如果返回成功，说明防火墙配置正确！

## 🔍 常见问题

### Q1: 找不到"防火墙"标签？
**A**: 尝试方法2，通过"应用搭建指南"进入

### Q2: 添加规则后仍然无法连接？
**A**: 
1. 检查规则是否保存成功
2. 等待1-2分钟让规则生效
3. 确认服务器上的服务正在运行：`ps aux | grep python3 | grep main.py`
4. 检查服务器防火墙（如果启用了）：`sudo ufw status`

### Q3: 如何查看我的公网IP？
**A**: 在浏览器访问 https://www.ipip.net/ 或 https://ip.sb/

### Q4: 如何删除规则？
**A**: 在防火墙页面，找到对应规则，点击"删除"或"移除"

## 🛡️ 安全建议

1. **开发阶段**: 可以使用 `0.0.0.0/0` 允许所有IP
2. **生产环境**: 建议只允许特定IP或IP段
3. **定期检查**: 定期审查防火墙规则，删除不需要的规则

## 📸 配置示例

配置后的规则列表应该包含：
```
┌──────────┬──────┬──────────┬──────────────┬──────────┐
│ 规则方向 │ 协议 │ 端口范围 │ 授权对象     │ 备注     │
├──────────┼──────┼──────────┼──────────────┼──────────┤
│ 入站规则 │ TCP  │ 8001     │ 0.0.0.0/0    │ FastAPI  │
└──────────┴──────┴──────────┴──────────────┴──────────┘
```


