# 上传代码到服务器指南

## 方法 1: 使用 scp 命令（推荐）

### 在你的 Mac 终端执行：

```bash
# 进入项目目录
cd ~/Desktop/AI军师/gemini-audio-service

# 上传 main.py 到服务器
scp main.py admin@47.79.254.213:~/gemini-audio-service/main.py
```

**说明**：
- `admin@47.79.254.213` - 服务器用户名和IP
- `~/gemini-audio-service/main.py` - 服务器上的目标路径
- 如果提示输入密码，请输入服务器密码

### 如果上传成功，你会看到：

```
main.py              100%   45KB  84.2KB/s   00:00
```

## 方法 2: 使用 SFTP（如果 scp 有问题）

```bash
# 连接到服务器
sftp admin@47.79.254.213

# 进入服务器目录
cd ~/gemini-audio-service

# 上传文件
put main.py

# 退出
exit
```

## 方法 3: 在服务器上直接编辑（如果上传失败）

如果 scp 上传有问题，可以 SSH 到服务器后直接编辑：

```bash
# SSH 到服务器
ssh admin@47.79.254.213

# 进入项目目录
cd ~/gemini-audio-service

# 备份原文件
cp main.py main.py.backup

# 使用 nano 编辑（或使用 vi/vim）
nano main.py
```

然后手动复制粘贴修改后的代码。

## 上传后需要做的

### 1. 检查文件是否上传成功

```bash
ssh admin@47.79.254.213
cd ~/gemini-audio-service
ls -lh main.py
```

### 2. 检查依赖

```bash
source venv/bin/activate
pip3 list | grep google-genai
```

如果没有 `google-genai`，安装：

```bash
pip3 install google-genai>=0.2.0
```

### 3. 重启服务

```bash
cd ~/gemini-audio-service
source venv/bin/activate
pkill -f 'python.*main.py'
sleep 2
nohup python3 main.py > ~/gemini-audio-service.log 2>&1 &
sleep 3
ps aux | grep 'python.*main.py' | grep -v grep
```

### 4. 验证服务启动

```bash
curl http://localhost:8001/health
```

## 常见问题

### 问题 1: Permission denied

**解决方案**：
- 检查 SSH 密钥是否正确配置
- 或使用密码登录

### 问题 2: 连接超时

**解决方案**：
- 检查网络连接
- 确认服务器 IP 地址正确
- 检查防火墙设置

### 问题 3: 文件路径不存在

**解决方案**：
- 先创建目录：`ssh admin@47.79.254.213 "mkdir -p ~/gemini-audio-service"`
- 然后再上传文件

## 一键上传脚本（可选）

创建一个脚本 `upload.sh`：

```bash
#!/bin/bash

echo "========== 上传代码到服务器 =========="
scp main.py admin@47.79.254.213:~/gemini-audio-service/main.py

if [ $? -eq 0 ]; then
    echo "✅ 上传成功！"
    echo ""
    echo "下一步：SSH 到服务器并重启服务"
    echo "ssh admin@47.79.254.213"
    echo "cd ~/gemini-audio-service && source venv/bin/activate && pkill -f 'python.*main.py' && nohup python3 main.py > ~/gemini-audio-service.log 2>&1 &"
else
    echo "❌ 上传失败，请检查网络连接和服务器地址"
fi
```

然后执行：

```bash
chmod +x upload.sh
./upload.sh
```
