# 服务器服务验证和配置

## ✅ 服务已启动

服务正在运行在 `http://0.0.0.0:8001`

## 最终验证步骤

### 1. 确认服务持续运行

```bash
# 检查进程
ps aux | grep python3 | grep main.py | grep -v grep

# 检查端口监听
sudo netstat -tlnp | grep 8001
# 或
sudo ss -tlnp | grep 8001
```

### 2. 测试 API 端点

```bash
# 健康检查
curl http://localhost:8001/health

# 测试任务列表（应该返回空列表或已有任务）
curl http://localhost:8001/api/v1/tasks/sessions

# 查看 API 文档
curl http://localhost:8001/docs
```

### 3. 检查防火墙/安全组

确保阿里云安全组允许 **8001 端口** 的入站流量：

1. 登录阿里云控制台
2. 进入 **ECS 实例** → **安全组**
3. 添加规则：
   - **端口范围**: 8001/8001
   - **授权对象**: 0.0.0.0/0（或你的 IP）
   - **协议**: TCP

### 4. 从外部测试（可选）

```bash
# 从你的 Mac 测试（替换为你的服务器 IP）
curl http://47.79.254.213:8001/health
```

## 查看实时日志

```bash
# 实时查看日志
tail -f /tmp/gemini-service.log

# 或查看最近的日志
tail -50 /tmp/gemini-service.log
```

## 停止服务（如果需要）

```bash
# 查找进程 ID
ps aux | grep python3 | grep main.py | grep -v grep

# 停止服务（替换 PID 为实际进程 ID）
kill <PID>

# 或强制停止
pkill -f "python3 main.py"
```

## 重启服务

```bash
cd ~/gemini-audio-service
source venv/bin/activate

# 停止旧进程
pkill -f "python3 main.py"

# 启动新进程
nohup python3 main.py > /tmp/gemini-service.log 2>&1 &

# 等待启动
sleep 3

# 验证
curl http://localhost:8001/health
```

## iOS 客户端配置

确保 iOS 客户端的 `NetworkManager.swift` 中的 `baseURL` 设置为：

```swift
private let baseURL = "http://47.79.254.213:8001/api/v1"
```

注意：端口是 **8001**，不是 80！

## 常见问题

### 问题 1: 无法从外部访问

**原因**: 防火墙/安全组未开放 8001 端口

**解决**: 在阿里云控制台配置安全组规则

### 问题 2: 服务意外停止

**原因**: 可能因为错误或资源不足

**解决**: 
```bash
# 查看错误日志
tail -100 /tmp/gemini-service.log

# 重新启动
cd ~/gemini-audio-service
source venv/bin/activate
nohup python3 main.py > /tmp/gemini-service.log 2>&1 &
```

### 问题 3: 端口被占用

**原因**: 可能有多个实例在运行

**解决**:
```bash
# 查找所有相关进程
ps aux | grep python3 | grep main.py

# 停止所有进程
pkill -f "python3 main.py"

# 重新启动
```


