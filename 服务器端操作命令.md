# 服务器端操作命令

## 方法 1: 使用 scp 从本地上传（推荐）

在你的 Mac 终端执行：

```bash
scp main.py admin@47.79.254.213:~/gemini-audio-service/main.py
```

## 方法 2: 直接在服务器上操作

SSH 到服务器后，执行以下命令：

### 1. 进入项目目录
```bash
cd ~/gemini-audio-service
```

### 2. 停止旧服务
```bash
pkill -f 'python.*main.py'
sleep 2
```

### 3. 检查服务是否已停止
```bash
ps aux | grep 'python.*main.py' | grep -v grep
```
（如果没有输出，说明已停止）

### 4. 启动新服务
```bash
# 如果使用虚拟环境
source venv/bin/activate

# 启动服务
nohup python3 main.py > ~/gemini-audio-service.log 2>&1 &
sleep 3
```

### 5. 检查服务是否启动成功
```bash
ps aux | grep 'python.*main.py' | grep -v grep
```

### 6. 测试健康检查
```bash
curl http://localhost:8001/health
```

### 7. 查看日志（如果需要）
```bash
tail -50 ~/gemini-audio-service.log
```

## 方法 3: 一键执行（在服务器上）

将以下命令复制到服务器上执行：

```bash
cd ~/gemini-audio-service && \
pkill -f 'python.*main.py' && \
sleep 2 && \
nohup python3 main.py > ~/gemini-audio-service.log 2>&1 & \
sleep 3 && \
ps aux | grep 'python.*main.py' | grep -v grep && \
echo "✅ 服务已重启" && \
curl -s http://localhost:8001/health | python3 -m json.tool || echo "健康检查失败"
```

## 查看服务器日志

```bash
# 查看最近 50 行日志
tail -50 ~/gemini-audio-service.log

# 查看上传相关的日志
grep -i 'upload\|audio\|收到音频上传请求\|准备返回响应' ~/gemini-audio-service.log | tail -30

# 查看错误日志
grep -i 'error\|exception\|失败\|traceback' ~/gemini-audio-service.log | tail -20

# 实时查看日志
tail -f ~/gemini-audio-service.log
```
