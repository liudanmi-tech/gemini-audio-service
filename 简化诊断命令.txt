# ============================================
# 简化诊断命令 - 分步执行（避免安全拦截）
# ============================================

# ============================================
# 步骤1：检查文件是否存在
# ============================================
cd /home/admin/gemini-audio-service && ls -lh main.py

# ============================================
# 步骤2：检查函数定义（只看关键部分）
# ============================================
cd /home/admin/gemini-audio-service && grep "async def analyze_audio_async" main.py

# ============================================
# 步骤3：检查函数调用（只看关键部分）
# ============================================
cd /home/admin/gemini-audio-service && grep "asyncio.create_task(analyze_audio_async" main.py

# ============================================
# 步骤4：检查是否有必要的变量
# ============================================
cd /home/admin/gemini-audio-service && grep -c "temp_file_path" main.py && grep -c "file_filename" main.py

# ============================================
# 步骤5：语法检查（简单版）
# ============================================
cd /home/admin/gemini-audio-service && python3 -m py_compile main.py && echo "语法正确" || echo "语法错误"

# ============================================
# 步骤6：测试服务启动（只看前5行输出）
# ============================================
cd /home/admin/gemini-audio-service && timeout 3 python3 main.py 2>&1 | head -5

