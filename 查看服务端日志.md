# 查看服务端日志指南

## 服务器信息
- **服务器IP**: 47.79.254.213
- **用户**: admin
- **日志文件**: `~/gemini-audio-service.log`

## 方法1: SSH连接查看日志

### 1. 连接到服务器
```bash
ssh admin@47.79.254.213
```

### 2. 查看完整日志文件
```bash
cat ~/gemini-audio-service.log
```

### 3. 查看日志的最后100行（推荐）
```bash
tail -n 100 ~/gemini-audio-service.log
```

### 4. 实时查看日志（跟随最新日志）
```bash
tail -f ~/gemini-audio-service.log
```

### 5. 查看最近的错误日志
```bash
# 查看最近100行中包含ERROR的行
tail -n 1000 ~/gemini-audio-service.log | grep -i error

# 或者查看最近500行
tail -n 500 ~/gemini-audio-service.log | grep -i error
```

### 6. 查看特定任务的日志
```bash
# 替换为实际的session_id
grep "5ce813e1-d670-4ef0-b585-9bcdf07f18c7" ~/gemini-audio-service.log
```

### 7. 查看分析失败的日志
```bash
# 查看包含"失败"或"failed"的日志
grep -i "失败\|failed\|error\|异常" ~/gemini-audio-service.log | tail -n 50
```

## 方法2: 如果日志文件路径不同

如果日志文件不在 `~/gemini-audio-service.log`，可以查找：

```bash
# 查找日志文件
find ~ -name "*gemini*log*" 2>/dev/null
find /home/admin -name "*.log" 2>/dev/null

# 或者在项目目录下
cd /home/admin/gemini-audio-service
ls -la *.log
```

## 方法3: 查看服务运行状态

### 1. 检查服务是否运行
```bash
# 查看Python进程
ps aux | grep "python.*main.py"

# 或者
ps aux | grep "gemini"
```

### 2. 查看服务端口
```bash
# 检查8001端口是否在监听
netstat -tlnp | grep 8001
# 或者
ss -tlnp | grep 8001
```

### 3. 测试服务是否正常
```bash
# 健康检查
curl http://localhost:8001/health

# 查看任务列表
curl http://localhost:8001/api/v1/tasks/sessions
```

## 方法4: 使用journalctl（如果使用systemd）

如果服务是用systemd管理的：

```bash
# 查看服务日志
journalctl -u gemini-service -n 100

# 实时查看
journalctl -u gemini-service -f

# 查看错误日志
journalctl -u gemini-service -p err
```

## 推荐的日志查看命令

对于你的问题（分析失败），推荐使用：

```bash
# 1. SSH连接到服务器
ssh admin@47.79.254.213

# 2. 查看最近的错误日志
tail -n 500 ~/gemini-audio-service.log | grep -i "error\|失败\|failed\|异常\|exception" -A 5 -B 5

# 3. 查看特定任务的完整日志
grep "5ce813e1-d670-4ef0-b585-9bcdf07f18c7" ~/gemini-audio-service.log | tail -n 100

# 4. 实时监控日志（在另一个终端窗口）
tail -f ~/gemini-audio-service.log
```

## 常见日志位置

根据代码，日志文件可能在这些位置：
- `~/gemini-audio-service.log` （用户主目录）
- `/home/admin/gemini-audio-service.log`
- 如果使用nohup运行：可能在启动命令的工作目录

## 快速诊断命令

```bash
# 一键查看最近100行日志和错误
echo "=== 最近100行日志 ==="
tail -n 100 ~/gemini-audio-service.log
echo ""
echo "=== 最近错误 ==="
tail -n 500 ~/gemini-audio-service.log | grep -i error | tail -n 20
```
