# 上传项目到服务器指南

## 方法 1: 使用 scp 上传（推荐）

在你的**本地 Mac** 上执行：

```bash
# 进入项目目录
cd ~/Desktop/AI军师/gemini-audio-service

# 上传整个项目到服务器
scp -r . admin@47.79.254.213:~/gemini-audio-service

# 或者只上传必要的文件
scp main.py requirements.txt .env admin@47.79.254.213:~/gemini-audio-service/
```

## 方法 2: 使用 rsync（推荐，支持增量同步）

```bash
# 进入项目目录
cd ~/Desktop/AI军师/gemini-audio-service

# 使用 rsync 上传（排除不需要的文件）
rsync -avz --exclude '__pycache__' --exclude '*.pyc' --exclude '.git' \
  . admin@47.79.254.213:~/gemini-audio-service/
```

## 方法 3: 使用 SFTP

```bash
# 连接服务器
sftp admin@47.79.254.213

# 在 SFTP 中执行
cd ~
mkdir -p gemini-audio-service
cd gemini-audio-service
put main.py
put requirements.txt
put .env
quit
```

## 方法 4: 手动创建（如果上传有问题）

在服务器上手动创建项目：

```bash
# 1. 创建项目目录
mkdir -p ~/gemini-audio-service
cd ~/gemini-audio-service

# 2. 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 3. 安装依赖
pip3 install fastapi uvicorn python-dotenv google-generativeai pydantic

# 4. 创建必要的文件（需要手动复制内容）
nano main.py
nano requirements.txt
nano .env
```

## 上传后，在服务器上执行

```bash
# 1. 进入项目目录
cd ~/gemini-audio-service

# 2. 激活虚拟环境
source venv/bin/activate

# 3. 安装依赖
pip3 install -r requirements.txt

# 4. 检查 .env 文件
cat .env
# 确保包含：
# GEMINI_API_KEY=your_key
# PROXY_URL=http://47.79.254.213/secret-channel
# USE_PROXY=true

# 5. 测试启动（前台）
python3 main.py
# 如果看到 "Uvicorn running on http://0.0.0.0:8001" 说明成功
# 按 Ctrl+C 停止

# 6. 后台启动
nohup python3 main.py > /tmp/gemini-service.log 2>&1 &

# 7. 检查进程
ps aux | grep python3 | grep main.py

# 8. 查看日志
tail -f /tmp/gemini-service.log

# 9. 测试 API
curl http://localhost:8001/health
```

## 快速上传脚本

在本地 Mac 上创建并执行：

```bash
#!/bin/bash
# upload.sh

SERVER="admin@47.79.254.213"
PROJECT_DIR="~/gemini-audio-service"

# 上传项目
rsync -avz --exclude '__pycache__' --exclude '*.pyc' --exclude '.git' \
  --exclude 'Models.swift' \
  --exclude '*.md' \
  --exclude '.DS_Store' \
  . $SERVER:$PROJECT_DIR/

# 在服务器上安装依赖并启动
ssh $SERVER << 'EOF'
cd ~/gemini-audio-service
if [ ! -d "venv" ]; then
    python3 -m venv venv
fi
source venv/bin/activate
pip3 install -r requirements.txt
pkill -f "python3 main.py" 2>/dev/null
nohup python3 main.py > /tmp/gemini-service.log 2>&1 &
sleep 2
ps aux | grep python3 | grep main.py
tail -20 /tmp/gemini-service.log
EOF
```

保存为 `upload.sh`，然后执行：
```bash
chmod +x upload.sh
./upload.sh
```


