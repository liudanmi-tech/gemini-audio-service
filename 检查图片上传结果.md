# 检查图片上传结果

## 1. 检查返回的 JSON 数据

```bash
python3 -c "
import json
with open('response.json', 'r') as f:
    data = json.load(f)
    
if data.get('code') == 200:
    visual_list = data.get('data', {}).get('visual', [])
    print(f'关键时刻数量: {len(visual_list)}')
    print()
    
    for i, v in enumerate(visual_list):
        has_url = '✅' if v.get('image_url') else '❌'
        has_base64 = '✅' if v.get('image_base64') else '❌'
        url = v.get('image_url', '')
        print(f'关键时刻 {i+1}:')
        print(f'  - image_url: {has_url}')
        if url:
            print(f'    URL: {url}')
        print(f'  - image_base64: {has_base64}')
        if v.get('image_base64'):
            print(f'    Base64 大小: {len(v.get(\"image_base64\", \"\"))} 字符')
        print()
else:
    print(f'❌ 请求失败: {data.get(\"message\")}')
"
```

## 2. 查看完整的图片生成日志

```bash
# 查看最近的图片生成相关日志
tail -200 ~/gemini-audio-service.log | grep -E "图片生成|上传图片|OSS|图片上传|image_url|Base64" | tail -30

# 或者查看所有相关日志
tail -200 ~/gemini-audio-service.log | grep -A 5 -B 5 "图片生成完成"
```

## 3. 检查是否有错误

```bash
tail -200 ~/gemini-audio-service.log | grep -E "错误|Error|失败|Failed|Exception" | tail -20
```

## 4. 检查 OSS 中的文件

```bash
python3 -c "
import os
from dotenv import load_dotenv
import oss2

load_dotenv()

try:
    auth = oss2.Auth(
        os.getenv('OSS_ACCESS_KEY_ID'),
        os.getenv('OSS_ACCESS_KEY_SECRET')
    )
    bucket = oss2.Bucket(auth, os.getenv('OSS_ENDPOINT'), os.getenv('OSS_BUCKET_NAME'))
    
    print('OSS 中的图片文件:')
    files = list(oss2.ObjectIterator(bucket, prefix='images/8760bbb9-0f67-41f1-9963-45156c554da5/'))
    if files:
        for obj in files:
            print(f'  ✅ {obj.key} ({obj.size} 字节)')
    else:
        print('  ❌ 没有找到文件')
except Exception as e:
    print(f'❌ 检查失败: {e}')
"
```
