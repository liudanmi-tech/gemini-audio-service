========== 0. 连接状态检测 ==========
当前用户: admin
当前主机: iZt4netdjt0adf5p1zrsbaZ
当前目录: /home/admin
✅ 已连接到服务器，gemini-audio-service 存在

========== 1. 进程与端口 ==========
Worker 数量应≥4，若只有1个则 --workers 4 未生效

========== 2. 本地连通性测试 ==========
health: HTTP 000 耗时 0.000203s
health 失败
sessions(无token): HTTP 000 耗时 0.000177s
sessions 失败
若无 token 应返回 401，若超时则说明请求卡在应用内

========== 3. 最近 Request/Response（请求是否到达应用）==========
2026-02-16 08:33:26,914 - main - INFO - [Response] /api/v1/audio/upload status=200 duration=37.356s
2026-02-16 08:33:26,914 - main - INFO - [Response] /api/v1/audio/upload status=200 duration=37.356s
若有 [Request] /api/v1/tasks/sessions 但无对应 [Response] → 请求卡在应用内
若完全无 [Request] tasks/sessions → 请求未到应用（Nginx 或网络问题）

========== 4. 任务列表与 Auth 明细 ==========
无匹配
若 [Auth] User 查询耗时 >2s → 数据库慢
若 [任务列表] Session 查询耗时 >2s → 数据库慢或缺索引

========== 5. 最近 ERROR/WARNING ==========
2026-02-16 08:33:15,978 - oss2.http - DEBUG - Send request, method: PUT, url: http://geminipicture2.oss-cn-beijing.aliyuncs.com/sessions%2Fa4ea0b95-51c8-467b-883d-b1f05c177952%2F6e3eb742-e51c-4c9f-b6f3-d02115c1d97d%2Foriginal.mp3, params: {}, headers: {'Content-Type': 'application/octet-stream', 'Accept-Encoding': None, 'User-Agent': 'aliyun-sdk-python/2.19.1(Linux/6.8.0-63-generic/x86_64;3.12.3)', 'date': 'Mon, 16 Feb 2026 00:33:15 GMT', 'authorization': 'OSS LTAI5tJP74B6p5Hx7AB9Dxj9:mN9ImhZH3SQLXkNT+AlleKjQb0U='}, timeout: 60, proxies: None
2026-02-16 08:33:15,978 - oss2.http - DEBUG - Send request, method: PUT, url: http://geminipicture2.oss-cn-beijing.aliyuncs.com/sessions%2Fa4ea0b95-51c8-467b-883d-b1f05c177952%2F6e3eb742-e51c-4c9f-b6f3-d02115c1d97d%2Foriginal.mp3, params: {}, headers: {'Content-Type': 'application/octet-stream', 'Accept-Encoding': None, 'User-Agent': 'aliyun-sdk-python/2.19.1(Linux/6.8.0-63-generic/x86_64;3.12.3)', 'date': 'Mon, 16 Feb 2026 00:33:15 GMT', 'authorization': 'OSS LTAI5tJP74B6p5Hx7AB9Dxj9:mN9ImhZH3SQLXkNT+AlleKjQb0U='}, timeout: 60, proxies: None
2026-02-16 08:33:29,177 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:29,177 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:29,233 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:29,233 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:30,221 - main - ERROR - ❌ 上传失败（第 1/3 次）
2026-02-16 08:33:30,221 - main - ERROR - ❌ 上传失败（第 1/3 次）
2026-02-16 08:33:30,222 - main - ERROR - 错误类型: TypeError
2026-02-16 08:33:30,222 - main - ERROR - 错误类型: TypeError
2026-02-16 08:33:30,222 - main - ERROR - 错误信息: string indices must be integers, not 'str'
2026-02-16 08:33:30,222 - main - ERROR - 错误信息: string indices must be integers, not 'str'
2026-02-16 08:33:30,222 - main - ERROR - 完整错误堆栈:
2026-02-16 08:33:30,222 - main - ERROR - 完整错误堆栈:
2026-02-16 08:33:30,224 - main - ERROR - Traceback (most recent call last):
2026-02-16 08:33:30,224 - main - ERROR - Traceback (most recent call last):
2026-02-16 08:33:30,224 - main - ERROR - 可能原因: 代理或 Gemini 返回了 HTML 错误页（如 502）或错误 JSON 结构；已设置文件服务走代理，若仍失败请检查 Nginx 与上游可达性。
2026-02-16 08:33:30,224 - main - ERROR - 可能原因: 代理或 Gemini 返回了 HTML 错误页（如 502）或错误 JSON 结构；已设置文件服务走代理，若仍失败请检查 Nginx 与上游可达性。
2026-02-16 08:33:35,225 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:35,225 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)

========== 6. Nginx 配置 ==========
    location /secret-channel/ {
        proxy_pass https://generativelanguage.googleapis.com;
        proxy_connect_timeout 600s;
        proxy_send_timeout 600s;
        proxy_read_timeout 600s;
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_connect_timeout 600s;
        proxy_send_timeout 600s;
        proxy_read_timeout 600s;
    location / {

========== 7. 最后 20 行原始日志 ==========
               ^^^^^^^^^^^^^^^^^^^
  File "/home/admin/gemini-audio-service/venv/lib/python3.12/site-packages/google/generativeai/client.py", line 125, in create_file
    return self.get_file({"name": result["file"]["name"]})
                                  ~~~~~~^^^^^^^^
TypeError: string indices must be integers, not 'str'

2026-02-16 08:33:30,224 - main - ERROR - 可能原因: 代理或 Gemini 返回了 HTML 错误页（如 502）或错误 JSON 结构；已设置文件服务走代理，若仍失败请检查 Nginx 与上游可达性。
2026-02-16 08:33:30,224 - main - ERROR - 可能原因: 代理或 Gemini 返回了 HTML 错误页（如 502）或错误 JSON 结构；已设置文件服务走代理，若仍失败请检查 Nginx 与上游可达性。
2026-02-16 08:33:30,224 - main - INFO - 下次重试将使用 resumable=False（简单上传）
2026-02-16 08:33:30,224 - main - INFO - 下次重试将使用 resumable=False（简单上传）
2026-02-16 08:33:30,224 - main - INFO - 等待 5 秒后重试...
2026-02-16 08:33:30,224 - main - INFO - 等待 5 秒后重试...
2026-02-16 08:33:35,224 - main - INFO - 尝试上传（第 1/3 次，resumable=False）...
2026-02-16 08:33:35,224 - main - INFO - 尝试上传（第 1/3 次，resumable=False）...
2026-02-16 08:33:35,225 - main - DEBUG - 调用 genai.upload_file()
2026-02-16 08:33:35,225 - main - DEBUG - 调用 genai.upload_file()
2026-02-16 08:33:35,225 - main - DEBUG - 参数: path=/tmp/tmpq4n7esn2.mp3, display_name=upload_2D08FA47-C444-43D4-8D81-9F6F64816A34.MP3
2026-02-16 08:33:35,225 - main - DEBUG - 参数: path=/tmp/tmpq4n7esn2.mp3, display_name=upload_2D08FA47-C444-43D4-8D81-9F6F64816A34.MP3
2026-02-16 08:33:35,225 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
2026-02-16 08:33:35,225 - googleapiclient._helpers - WARNING - execute() takes at most 1 positional argument (3 given)
