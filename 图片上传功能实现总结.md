# 图片上传功能实现总结

## 已完成的工作

### 1. 服务端（已上传）
- ✅ 在 `api/profiles.py` 中添加了 `/api/v1/profiles/upload-photo` 端点
- ✅ 支持上传图片到OSS并返回URL
- ✅ 文件已上传到服务器

### 2. 客户端
- ✅ 在 `NetworkManager.swift` 中添加了 `uploadProfilePhoto(imageData:)` 方法
- ✅ 在 `ProfileEditView.swift` 中实现了选择图片后自动上传
- ✅ 上传成功后自动更新 `viewModel.photoUrl`

## 需要重启服务

请在服务器上执行以下命令重启服务：

```bash
cd ~/gemini-audio-service
pkill -f "python.*main.py"
sleep 2
source venv/bin/activate
nohup python3 main.py > ~/gemini-audio-service.log 2>&1 &
sleep 5
ps aux | grep "[p]ython.*main.py"
```

## 功能说明

1. **选择图片**：用户点击照片选择器选择图片
2. **自动上传**：选择后立即上传到服务器（OSS）
3. **获取URL**：服务器返回图片URL
4. **保存档案**：点击保存时，`photoUrl` 会包含在更新请求中

## 测试步骤

1. 打开档案编辑页面
2. 点击照片选择器，选择一张图片
3. 等待上传完成（查看控制台日志）
4. 点击"保存"按钮
5. 检查档案是否成功保存了图片URL

## 注意事项

- 图片上传是异步的，选择图片后会立即开始上传
- 如果上传失败，会在控制台输出错误信息
- 上传成功后，`viewModel.photoUrl` 会自动更新
- 保存档案时，会使用最新的 `photoUrl`
