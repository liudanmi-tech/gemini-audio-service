# 策略分析超时修复说明

## 问题现象

```
❌ [StrategyAnalysisView] 策略分析加载失败: 连接中断或超时，策略可能仍在生成中，请稍后重试
NSErrorFailingURLStringKey=http://47.79.254.213/api/v1/tasks/sessions/xxx/strategies
```

## 原因

1. **Nginx 超时过短**：策略生成包含场景识别、多技能 Gemini 调用、图片生成，常需 2–5 分钟。若 `proxy_read_timeout` 为 60s 或 120s，Nginx 会提前断开连接。
2. **客户端超时**：已调整为 600 秒，与 Nginx 一致。

## 修复步骤

### 1. 服务端：Nginx 超时改为 600 秒

通过 **阿里云控制台 → 实例 → 远程连接** 登录服务器，复制执行 `阿里云远程连接-复制执行-修正版.txt` 中的整段命令。该脚本会：

- 重启 uvicorn 应用
- 将 `proxy_read_timeout`、`proxy_send_timeout`、`proxy_connect_timeout` 从 60s/120s 改为 600s
- 重载 Nginx

### 2. 客户端：重新编译 iOS 应用

`NetworkManager.swift` 中策略接口超时已改为 600 秒，重新编译并安装即可。

### 3. 验证

- 在服务器执行：`grep proxy_read_timeout /etc/nginx/sites-available/gemini-and-api`，应看到 600s
- 打开任务详情 → 策略分析 Tab，等待 2–5 分钟，应能正常加载
