# 快速测试任务详情接口 - 执行指南

## 步骤1: 上传测试脚本到服务器

在Cursor终端中执行：

```bash
cd ~/Desktop/AI军师/gemini-audio-service
scp 服务器测试脚本.sh admin@47.79.254.213:~/gemini-audio-service/
```

输入密码：`Ld123456`

## 步骤2: 连接服务器

```bash
ssh admin@47.79.254.213
```

输入密码：`Ld123456`

## 步骤3: 在服务器上执行测试

```bash
cd ~/gemini-audio-service
chmod +x 服务器测试脚本.sh
bash 服务器测试脚本.sh
```

## 或者：直接在服务器上执行测试命令

如果不想上传脚本，可以直接在服务器上执行以下命令：

```bash
cd ~/gemini-audio-service
source venv/bin/activate

# 发送验证码
curl -s -X POST "http://localhost:8001/api/v1/auth/send-code" \
  -H "Content-Type: application/json" \
  -d '{"phone": "13800138000"}'

sleep 2

# 登录获取Token
LOGIN_RESPONSE=$(curl -s -X POST "http://localhost:8001/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"phone": "13800138000", "code": "123456"}')

TOKEN=$(echo "$LOGIN_RESPONSE" | python3 -c "import sys, json; print(json.load(sys.stdin).get('data', {}).get('token', ''))" 2>/dev/null)

echo "Token: ${TOKEN:0:20}..."

# 获取任务列表
TASK_LIST=$(curl -s -X GET "http://localhost:8001/api/v1/tasks/sessions?page=1&page_size=1" \
  -H "Authorization: Bearer $TOKEN")

SESSION_ID=$(echo "$TASK_LIST" | python3 -c "import sys, json; data=json.load(sys.stdin); sessions=data.get('data', {}).get('sessions', []); print(sessions[0]['session_id'] if sessions else '')" 2>/dev/null)

if [ -z "$SESSION_ID" ]; then
    SESSION_ID="6576aab2-e536-4ab8-94b9-50aa86438b21"
fi

echo "Session ID: $SESSION_ID"

# 测试任务详情接口（带时间测量）
echo "=== 测试任务详情接口 ==="
time curl -s --max-time 30 -X GET "http://localhost:8001/api/v1/tasks/sessions/$SESSION_ID" \
  -H "Authorization: Bearer $TOKEN" | python3 -m json.tool | head -50
```

## 预期结果

- 如果接口响应正常：会显示JSON格式的任务详情，响应时间应该 < 5秒
- 如果接口响应慢：响应时间 > 10秒，需要优化
- 如果接口失败：会显示错误信息

## 测试完成后

请把测试结果发给我，我会根据结果继续优化代码。
